<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        /* background: url("./image/bg.jpeg") center / cover no-repeat fixed; */
        /* background: linear-gradient(to bottom right, #e3f0ff, #fafcff); */
        background-color: #444442;
        height: 100vh;
        display: flex;
        justify-content: center;
      }
      .Cart-Container {
        margin-top: 5rem;
        width: 70%;
        height: 95%;
        /* background-color: #ffffff; */
        background-color: rgb(255 255 255 / 0.3);
        border-radius: 20px;
        box-shadow: 0 0 10px 1px rgba(0, 0, 0, 0.25);
        backdrop-filter: blur(5px);
      }
      .Header {
        margin: auto;
        width: 90%;
        height: 25%;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .Heading {
        font-size: 20px;
        font-family: "Open Sans";
        font-weight: 700;
        color: #2f3841;
      }
      .Action {
        font-size: 14px;
        font-family: "Open Sans";
        font-weight: 600;
        color: #e44c4c;
        cursor: pointer;
        border-bottom: 1px solid #e44c4c;
      }
      .Cart-Items {
        margin: auto;
        width: 90%;
        height: 130px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .image-box {
        width: 15%;
        text-align: center;
      }
      .about {
        height: 100%;
      }
      .title {
        padding-top: 5px;
        line-height: 10px;
        font-size: 32px;
        font-family: "Open Sans";
        font-weight: 800;
        color: #202020;
      }
      .subtitle {
        line-height: 10px;
        font-size: 18px;
        font-family: "Open Sans";
        font-weight: 600;
        color: rgb(155,155,155);
      }
      .counter {
        width: 15%;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #d9d9d9;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        font-family: "Open Sans";
        font-weight: 900;
        color: #202020;
        cursor: pointer;
      }
      .count {
        font-size: 20px;
        font-family: "Open Sans";
        font-weight: 900;
        color: #202020;
      }
      .prices {
        height: 100%;
        text-align: right;
      }
      .amount {
        padding-top: 20px;
        font-size: 26px;
        font-family: "Open Sans";
        font-weight: 800;
        color: #202020;
      }

      hr {
        width: 66%;
        float: right;
        margin-right: 5%;
      }
      .checkout {
        float: right;
        margin-right: 5%;
        width: 28%;
      }
      .total {
        width: 100%;
        display: flex;
        justify-content: space-between;
      }
      .Subtotal {
        font-size: 22px;
        font-family: "Open Sans";
        font-weight: 700;
        color: #202020;
      }
      .items {
        font-size: 16px;
        font-family: "Open Sans";
        font-weight: 500;
        color: #909090;
        line-height: 10px;
      }
      .total-amount {
        font-size: 36px;
        font-family: "Open Sans";
        font-weight: 900;
        color: #202020;
      }
      .button {
        margin-top: 5px;
        width: 100%;
        height: 40px;
        border: none;
        background: linear-gradient(to bottom right, #b8d7ff, #8eb7eb);
        border-radius: 20px;
        cursor: pointer;
        font-size: 16px;
        font-family: "Open Sans";
        font-weight: 600;
        color: #202020;
        transition: all 3s linear;
      }

      .button:hover {
        background: linear-gradient(to bottom right, #cbdcf4, #4d64e9);
      }

      .inc:hover {
        background-color: rgb(55, 157, 55);
      }
      .dec:hover {
        background-color: rgb(250, 58, 58);
      }
    </style>
  </head>
  <body>
    <div class="Cart-Container" id="cart"></div>

    <script>

let url=window.location.href.split("/");
url.pop();
url=url.join("/");

let userD = localStorage.getItem("userData");
  if(userD==null)
  {
    window.location=`${url}/index.html`;
  }
      let allTotal = 0;

      let cart = document.getElementById("cart");
      let user = JSON.parse(
        localStorage.getItem(localStorage.getItem("userData"))
      );
      let cartItem = user.cart;
      console.log(user);

      function increaseSeat(id) {
        for (let i = 0; i < user.cart.length; i++) {
          if (user.cart[i].id == id) {
            user.cart[i].seat = user.cart[i].seat + 1;
            break;
          }
        }

        console.log(user);

        localStorage.setItem(
          localStorage.getItem("userData"),
          JSON.stringify(user)
        );
        window.location = `${url}/cart.html`;
      }

      function decreaseSeat(id) {
        for (let i = 0; i < user.cart.length; i++) {
          if (user.cart[i].id == id) {
            user.cart[i].seat = user.cart[i].seat - 1;
            if (user.cart[i].seat == 0) {
              user.cart = user.cart.filter((item) => item.id != id);
            }
            break;
          }
        }
        localStorage.setItem(
          localStorage.getItem("userData"),
          JSON.stringify(user)
        );
        window.location = `${url}/cart.html`;
      }

      function removeAll() {
        if(confirm("Are you sure ?"))
        {
        user.cart = [];
        localStorage.setItem(
          localStorage.getItem("userData"),
          JSON.stringify(user)
        );
        window.location = `${url}/cart.html`;
        }
      }

      function checkOut() {
        user.order = [...user.order, ...user.cart];
        user.cart = [];
        localStorage.setItem(
          localStorage.getItem("userData"),
          JSON.stringify(user)
        );
        alert("Successfully booked event ticket..")
        window.location = `${url}/profile.html`;
      }

      let str = `<div class="Header">
        <h3 class="Heading">Booking Cart</h3>
        <h5 class="Action" onclick="removeAll()">Remove all</h5>
      </div>`;

      for (let i = 0; i < cartItem.length; i++) {
        let total = cartItem[i].price * cartItem[i].seat;
        allTotal += total;
        str += `
        <div class="Cart-Items">
        <div class="image-box">
          <img src="${cartItem[i].img}" style="height: 120px" />
        </div>
        <div class="about">
          <h1 class="title">${cartItem[i].event_name}</h1>
          <h3 class="subtitle">${cartItem[i].price} &#8377;</h3>
          <h3>${cartItem[i].location}</h3>
        </div>
        <div class="counter">
          <div class="btn inc" onclick="increaseSeat(${cartItem[i].id})">+</div>
          <div class="count">${cartItem[i].seat}</div>
          <div class="btn dec" onclick="decreaseSeat(${cartItem[i].id})">-</div>
        </div>
        <div class="prices">
          <div class="amount">${total} &#8377;</div>
        </div>
      </div>
      <hr/>
        `;
      }

      str += `
      <div class="checkout">
        <div class="total">
          <div>
            <div class="Subtotal">Total</div>
          </div>
          <div class="total-amount">${allTotal} &#8377;</div>
        </div>
        <button class="button" type="button" onclick="checkOut()">Checkout</button>
      </div>
    </div>`;

      cart.innerHTML = str;
    </script>
    <!-- <script src="./script.js"></script> -->
  </body>
</html>
